<html>
<head>
    @{
        ViewBag.Title = "Index";
    }
    <!--Histogram-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript">

        google.load("current", { packages: ["corechart"] });

        google.setOnLoadCallback.then(function () {
            $('#btnDisplay').on('click', function () {
                var start = $("stop").find("option:selected").val();
                var stop = $("start").find("option:selected").val();
                var wojewodztwo = $("wojewodztwo").find("option:selected").val();
                drawChart(start, stop, wojewodztwo);
                return false;
            });

        google.charts.setOnLoadCallback(drawChart(start, stop, wojewodztwo));

            function drawChart(start, stop, wojewodztwo) {
                /*  
                var obj = {};
                obj.start = start;
                obj.stop = stop;
                obj.stop = wojewodztwo;
                */
                $.ajax({

                    url: "/Histogram/AjaxMethod",
                    /*data: {
                        data__value = JSON.stringify(
                            {
                                start: $("start").find("option:selected").val(),
                                stop: $("stop").find("option:selected").val(),
                                wojewodztwo: $("wojewodztwo").find("option:selected").val()
                            })
                    },*/
                    //data: JSON.stringify(obj),

                        data: JSON.stringify({
                        'start': $("start").find("option:selected").val(),
                        'stop': $("stop").find("option:selected").val(),
                        'wojewodztwo': $("wojewodztwo").find("option:selected").val()
                    }),
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json"
                }).done(function (data) {
                    var options = {
                    };
                    newdata = data.reduce((arr, x) => arr.concat({ "zgony": x[0] }), [])
                    var data = google.visualization.arrayToDataTable(newdata.d);
                    var chart = new google.visualization.Histogram(document.getElementById('divChart'));
                    chart.draw(data, options);
                }).fail(function (err) {
                    console.log(err);
                }).error(function (err) {
                    console.log(err);
                });
            }
        });
    </script>

</head>
<body>
@using (Html.BeginForm("AjaxMethod", "Histogram", FormMethod.Post))
 {
    <h4>Histogram zgonów dla województw</h4>
    @Html.DropDownList("wojewodztwo", (SelectList)ViewBag.wojewodztwo, new { @class = "form-control" })
    <span>Data początkowa:</span>
    <input type="date" id="start" placeholder="start" name="start" value="2021-01-28" min="2021-01-28" />
    <span>Data końcowa:</span>
    <input type="date" id="stop" placeholder="stop" name="stop" value="2021-01-28" min="2021-01-28" />
    <input type="submit" id="bntDisplay" value="Wyszukaj">
    <br />
    <div id="divChart">
    </div>
 }
    </body>
</html>